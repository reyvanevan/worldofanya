<!DOCTYPE html>
<html lang="id" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Control | World of Anya</title>

    <!-- Tailwind & Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            pink: '#FCE7F3',
                            blue: '#E0F2FE',
                            dark: '#0f172a',
                            accent: '#db2777',
                            accentLight: '#f472b6',
                            gold: '#fbbf24'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'spin-slow': 'spin 8s linear infinite',
                    }
                }
            }
        }

        // Theme Check
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Styles -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">

    <!-- Firebase Auth & Firestore -->
    <script type="module">
        import { auth, db } from '../js/firebase-config.js';
        import { compressImageToBase64 } from '../js/firestore-service.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // Make compressImageToBase64 available globally
        window.compressImageToBase64 = compressImageToBase64;

        // Check if user is authenticated
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'login.html';
            } else {
                window.currentUser = user;
                // Load data from Firestore
                await loadDashboardData();
                document.getElementById('loading-screen')?.remove();
            }
        });

        // Load all data from Firestore
        async function loadDashboardData() {
            try {
                // Load Anya Profile (Princess)
                const profileDoc = await getDoc(doc(db, "landing", "profile"));
                if (profileDoc.exists()) {
                    const profile = profileDoc.data();
                    document.getElementById('input-name').value = profile.name || '';
                    document.getElementById('input-title').value = profile.title || '';
                    document.getElementById('input-bio').value = profile.bio || '';
                    document.getElementById('profilePreview').src = profile.photo || '';
                    if (profile.tags) {
                        document.getElementById('input-tag1').value = profile.tags[0] || '';
                        document.getElementById('input-tag2').value = profile.tags[1] || '';
                        document.getElementById('input-tag3').value = profile.tags[2] || '';
                    }
                }

                // Load Stats
                const statsDoc = await getDoc(doc(db, "landing", "stats"));
                if (statsDoc.exists()) {
                    const stats = statsDoc.data();
                    document.getElementById('stat-visits').textContent = stats.totalVisits?.toLocaleString() || '0';
                    document.getElementById('stat-memories').textContent = stats.memoriesCount || '0';
                    // Calculate days together
                    if (stats.startDate) {
                        const start = stats.startDate.toDate ? stats.startDate.toDate() : new Date(stats.startDate);
                        const days = Math.floor((new Date() - start) / (1000 * 60 * 60 * 24));
                        document.getElementById('stat-days').textContent = days.toLocaleString();
                    }
                }

                // Load Gallery
                const galleryDoc = await getDoc(doc(db, "landing", "gallery"));
                if (galleryDoc.exists()) {
                    const gallery = galleryDoc.data();
                    gallery.items?.forEach((item, i) => {
                        const img = document.getElementById(`gal${i + 1}`);
                        const caption = document.getElementById(`gal${i + 1}-caption`);
                        if (img) img.src = item.url;
                        if (caption) caption.value = item.caption;
                    });
                }

                // Load Memories
                const memoriesDoc = await getDoc(doc(db, "landing", "memories"));
                if (memoriesDoc.exists()) {
                    const memories = memoriesDoc.data();
                    memories.items?.forEach((item, i) => {
                        const title = document.getElementById(`mem${i + 1}-title`);
                        const desc = document.getElementById(`mem${i + 1}-desc`);
                        const img = document.getElementById(`mem${i + 1}`);
                        if (title) title.value = item.title;
                        if (desc) desc.value = item.description;
                        if (img && item.image) img.src = item.image;
                    });
                }

                // Load Letter
                const letterDoc = await getDoc(doc(db, "landing", "letter"));
                if (letterDoc.exists()) {
                    const letter = letterDoc.data();
                    const titleInput = document.getElementById('letter-title');
                    const contentInput = document.getElementById('letter-content');
                    const quoteInput = document.getElementById('letter-quote');
                    
                    if (titleInput) titleInput.value = letter.title || '';
                    if (contentInput) contentInput.value = letter.content || '';
                    if (quoteInput) quoteInput.value = letter.quote || '';
                    
                    // Update preview
                    const previewTitle = document.getElementById('letter-preview-title');
                    const previewContent = document.getElementById('letter-preview-content');
                    const previewQuote = document.getElementById('letter-preview-quote');
                    
                    if (previewTitle) previewTitle.textContent = letter.title || 'Hai Anya...';
                    if (previewContent) previewContent.textContent = letter.content || 'Your message will appear here...';
                    if (previewQuote) previewQuote.textContent = '"' + (letter.quote || 'I love you, today and forever.') + '"';
                }

                // Load Princess Profile (her.html)
                const herProfileDoc = await getDoc(doc(db, "landing", "profileHer"));
                if (herProfileDoc.exists()) {
                    const herProfile = herProfileDoc.data();
                    document.getElementById('input-princess-name').value = herProfile.name || '';
                    document.getElementById('input-princess-title').value = herProfile.title || '';
                    document.getElementById('input-princess-bio').value = herProfile.bio || '';
                    document.getElementById('princessProfilePreview').src = herProfile.photo || '';
                    
                    // Load Princess Gallery
                    if (herProfile.gallery && herProfile.gallery.length > 0) {
                        window.princessGallery = herProfile.gallery;
                        renderPrincessGallery(herProfile.gallery);
                    } else {
                        window.princessGallery = [];
                        renderPrincessGallery([]);
                    }
                }

                // Load Rey Profile (him.html)
                const reyProfileDoc = await getDoc(doc(db, "landing", "profileRey"));
                if (reyProfileDoc.exists()) {
                    const reyProfile = reyProfileDoc.data();
                    document.getElementById('input-rey-name').value = reyProfile.name || '';
                    document.getElementById('input-rey-title').value = reyProfile.title || '';
                    document.getElementById('input-rey-bio').value = reyProfile.bio || '';
                    document.getElementById('reyProfilePreview').src = reyProfile.photo || '';
                    
                    // Update sidebar admin avatar and name
                    const sidebarAvatar = document.getElementById('sidebarAdminAvatar');
                    const sidebarName = document.getElementById('sidebarAdminName');
                    if (sidebarAvatar && reyProfile.photo) sidebarAvatar.src = reyProfile.photo;
                    if (sidebarName && reyProfile.name) sidebarName.textContent = reyProfile.name;
                    
                    // Display stickers
                    if (reyProfile.stickers && reyProfile.stickers.length > 0) {
                        window.currentReyStickers = reyProfile.stickers;
                        renderStickers(reyProfile.stickers);
                    } else {
                        window.currentReyStickers = [];
                    }
                    
                    // Load Guardian Gallery
                    if (reyProfile.gallery && reyProfile.gallery.length > 0) {
                        window.guardianGallery = reyProfile.gallery;
                        renderGuardianGallery(reyProfile.gallery);
                    } else {
                        window.guardianGallery = [];
                        renderGuardianGallery([]);
                    }
                }
                
                // Check user role for permissions
                await checkUserRole();

                console.log('âœ… Dashboard data loaded from Firestore');
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Check user role and apply permissions
        async function checkUserRole() {
            if (!window.currentUser) return;
            
            try {
                const userIds = ['rey', 'anya'];
                let foundUser = null;
                
                for (const userId of userIds) {
                    const userDoc = await getDoc(doc(db, 'users', userId));
                    if (userDoc.exists() && userDoc.data().email === window.currentUser.email) {
                        foundUser = { id: userId, ...userDoc.data() };
                        break;
                    }
                }
                
                window.currentUserRole = foundUser;
                
                if (foundUser) {
                    if (foundUser.role === 'princess') {
                        // Anya can only view Rey's profile (no edit), but can add stickers
                        document.getElementById('btn-save-rey-profile').style.display = 'none';
                        document.getElementById('rey-photo-overlay').style.display = 'none';
                        document.getElementById('rey-photo-input').style.display = 'none';
                        document.getElementById('input-rey-name').disabled = true;
                        document.getElementById('input-rey-bio').disabled = true;
                        document.getElementById('input-rey-name').classList.add('opacity-60', 'cursor-not-allowed');
                        document.getElementById('input-rey-bio').classList.add('opacity-60', 'cursor-not-allowed');
                        
                        // Show sticker picker for Anya
                        document.getElementById('sticker-picker').classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error('Error checking user role:', error);
            }
        }
        
        // Render stickers
        function renderStickers(stickers) {
            const container = document.getElementById('rey-stickers-display');
            const noStickersMsg = document.getElementById('no-stickers-msg');
            
            if (stickers && stickers.length > 0) {
                if (noStickersMsg) noStickersMsg.style.display = 'none';
                container.innerHTML = stickers.map((s, i) => `
                    <span class="text-2xl hover:scale-110 transition cursor-default" title="Added by Anya">${s}</span>
                `).join('');
            } else {
                container.innerHTML = '<span class="text-slate-400 text-xs" id="no-stickers-msg">No stickers yet ðŸ’•</span>';
            }
        }
        
        // Render Princess Gallery
        function renderPrincessGallery(gallery) {
            const container = document.getElementById('princess-gallery-grid');
            if (!container) return;
            
            if (!gallery || gallery.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="w-16 h-16 mx-auto rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center mb-3">
                            <i data-lucide="image" class="w-6 h-6 text-slate-400"></i>
                        </div>
                        <p class="text-slate-400 text-sm">No photos yet</p>
                        <p class="text-slate-400 text-xs">Click "Add Photo" to upload</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            container.innerHTML = gallery.map((photo, idx) => `
                <div class="relative group aspect-square rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700">
                    <img src="${photo.url}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center gap-2 p-2">
                        <div class="flex gap-2">
                            <button onclick="togglePhotoVisibility('princess', ${idx})" class="p-2 rounded-full ${photo.showOnProfile ? 'bg-green-500' : 'bg-slate-500'} text-white hover:scale-110 transition" title="${photo.showOnProfile ? 'Visible on profile' : 'Hidden from profile'}">
                                <i data-lucide="${photo.showOnProfile ? 'eye' : 'eye-off'}" class="w-4 h-4"></i>
                            </button>
                            <button onclick="removePrincessPhoto(${idx})" class="p-2 rounded-full bg-red-500 text-white hover:scale-110 transition" title="Remove photo">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <input type="text" value="${photo.caption || ''}" onchange="updatePrincessPhotoCaption(${idx}, this.value)" class="w-full text-xs text-center bg-transparent border-b border-white/30 text-white placeholder-white/50 py-1 focus:outline-none" placeholder="Caption...">
                    </div>
                    ${photo.showOnProfile ? '<span class="absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full"></span>' : ''}
                </div>
            `).join('');
            lucide.createIcons();
        }
        
        // Render Guardian Gallery
        function renderGuardianGallery(gallery) {
            const container = document.getElementById('guardian-gallery-grid');
            if (!container) return;
            
            if (!gallery || gallery.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="w-16 h-16 mx-auto rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center mb-3">
                            <i data-lucide="image" class="w-6 h-6 text-slate-400"></i>
                        </div>
                        <p class="text-slate-400 text-sm">No photos yet</p>
                        <p class="text-slate-400 text-xs">Click "Add Photo" to upload</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }
            
            container.innerHTML = gallery.map((photo, idx) => `
                <div class="relative group aspect-square rounded-xl overflow-hidden border border-slate-200 dark:border-slate-700">
                    <img src="${photo.url}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center gap-2 p-2">
                        <div class="flex gap-2">
                            <button onclick="togglePhotoVisibility('guardian', ${idx})" class="p-2 rounded-full ${photo.showOnProfile ? 'bg-green-500' : 'bg-slate-500'} text-white hover:scale-110 transition" title="${photo.showOnProfile ? 'Visible on profile' : 'Hidden from profile'}">
                                <i data-lucide="${photo.showOnProfile ? 'eye' : 'eye-off'}" class="w-4 h-4"></i>
                            </button>
                            <button onclick="removeGuardianPhoto(${idx})" class="p-2 rounded-full bg-red-500 text-white hover:scale-110 transition" title="Remove photo">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <input type="text" value="${photo.caption || ''}" onchange="updateGuardianPhotoCaption(${idx}, this.value)" class="w-full text-xs text-center bg-transparent border-b border-white/30 text-white placeholder-white/50 py-1 focus:outline-none" placeholder="Caption...">
                    </div>
                    ${photo.showOnProfile ? '<span class="absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full"></span>' : ''}
                </div>
            `).join('');
            lucide.createIcons();
        }
        
        // Toggle photo visibility
        window.togglePhotoVisibility = function(type, idx) {
            if (type === 'princess') {
                window.princessGallery[idx].showOnProfile = !window.princessGallery[idx].showOnProfile;
                renderPrincessGallery(window.princessGallery);
            } else {
                window.guardianGallery[idx].showOnProfile = !window.guardianGallery[idx].showOnProfile;
                renderGuardianGallery(window.guardianGallery);
            }
        };
        
        // Update photo caption
        window.updatePrincessPhotoCaption = function(idx, caption) {
            window.princessGallery[idx].caption = caption;
        };
        
        window.updateGuardianPhotoCaption = function(idx, caption) {
            window.guardianGallery[idx].caption = caption;
        };
        
        // Remove photo
        window.removePrincessPhoto = function(idx) {
            if (confirm('Remove this photo?')) {
                window.princessGallery.splice(idx, 1);
                renderPrincessGallery(window.princessGallery);
            }
        };
        
        window.removeGuardianPhoto = function(idx) {
            if (confirm('Remove this photo?')) {
                window.guardianGallery.splice(idx, 1);
                renderGuardianGallery(window.guardianGallery);
            }
        };
        
        // Gallery Upload Modal Functions
        window.currentGalleryTarget = null; // 'princess' or 'guardian'
        
        window.openGalleryUploadModal = function(target) {
            window.currentGalleryTarget = target;
            document.getElementById('gallery-upload-modal').classList.remove('hidden');
            document.getElementById('gallery-upload-preview').src = '';
            document.getElementById('gallery-upload-preview').classList.add('hidden');
            document.getElementById('gallery-upload-placeholder').classList.remove('hidden');
            document.getElementById('gallery-upload-caption').value = '';
            document.getElementById('gallery-file-input').value = '';
            
            // Update modal title based on target
            const title = target === 'princess' ? 'Add Photo - Princess Gallery' : 'Add Photo - Guardian Gallery';
            document.getElementById('gallery-modal-title').textContent = title;
        };
        
        window.closeGalleryUploadModal = function() {
            document.getElementById('gallery-upload-modal').classList.add('hidden');
            window.currentGalleryTarget = null;
        };
        
        window.handleGalleryFileSelect = function(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('gallery-upload-preview').src = e.target.result;
                    document.getElementById('gallery-upload-preview').classList.remove('hidden');
                    document.getElementById('gallery-upload-placeholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        };
        
        window.submitGalleryPhoto = async function() {
            const fileInput = document.getElementById('gallery-file-input');
            const caption = document.getElementById('gallery-upload-caption').value.trim();
            const submitBtn = document.getElementById('gallery-submit-btn');
            
            if (!fileInput.files || !fileInput.files[0]) {
                alert('Please select an image first');
                return;
            }
            
            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Uploading...';
                lucide.createIcons();
                
                // Compress image to Base64
                const base64Image = await window.compressImageToBase64(fileInput.files[0], 800, 0.8);
                
                const newPhoto = {
                    id: Date.now(),
                    url: base64Image,
                    caption: caption,
                    showOnProfile: true
                };
                
                if (window.currentGalleryTarget === 'princess') {
                    window.princessGallery = window.princessGallery || [];
                    window.princessGallery.push(newPhoto);
                    renderPrincessGallery(window.princessGallery);
                } else {
                    window.guardianGallery = window.guardianGallery || [];
                    window.guardianGallery.push(newPhoto);
                    renderGuardianGallery(window.guardianGallery);
                }
                
                submitBtn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Added!';
                submitBtn.classList.remove('bg-blue-500');
                submitBtn.classList.add('bg-green-500');
                lucide.createIcons();
                
                setTimeout(() => {
                    closeGalleryUploadModal();
                    submitBtn.innerHTML = '<i data-lucide="upload" class="w-4 h-4"></i> Add Photo';
                    submitBtn.classList.remove('bg-green-500');
                    submitBtn.classList.add('bg-blue-500');
                    submitBtn.disabled = false;
                    lucide.createIcons();
                }, 1000);
                
            } catch (error) {
                console.error('Upload error:', error);
                alert('Failed to upload image: ' + error.message);
                submitBtn.innerHTML = '<i data-lucide="upload" class="w-4 h-4"></i> Add Photo';
                submitBtn.disabled = false;
                lucide.createIcons();
            }
        };
        
        // Wrapper functions for backward compatibility
        window.addPrincessGalleryPhoto = function() {
            openGalleryUploadModal('princess');
        };
        
        window.addGuardianGalleryPhoto = function() {
            openGalleryUploadModal('guardian');
        };
        
        // Add sticker (for Anya)
        window.addSticker = async function(emoji) {
            if (!window.currentUserRole || window.currentUserRole.role !== 'princess') {
                return;
            }
            
            try {
                const stickers = window.currentReyStickers || [];
                stickers.push(emoji);
                window.currentReyStickers = stickers;
                
                await setDoc(doc(db, "landing", "profileRey"), {
                    stickers: stickers,
                    updatedAt: new Date()
                }, { merge: true });
                
                renderStickers(stickers);
                
                // Visual feedback
                const picker = document.getElementById('sticker-picker');
                picker.classList.add('animate-pulse');
                setTimeout(() => picker.classList.remove('animate-pulse'), 500);
                
            } catch (error) {
                console.error('Error adding sticker:', error);
            }
        };

        // Save Rey Profile Data
        window.saveReyProfile = async function() {
            const btn = document.getElementById('btn-save-rey-profile');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Saving...';
            btn.disabled = true;

            try {
                await setDoc(doc(db, "landing", "profileRey"), {
                    name: document.getElementById('input-rey-name').value,
                    title: document.getElementById('input-rey-title').value,
                    bio: document.getElementById('input-rey-bio').value,
                    photo: document.getElementById('reyProfilePreview').src,
                    stickers: window.currentReyStickers || [],
                    gallery: window.guardianGallery || [],
                    updatedAt: new Date()
                });

                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Saved!';
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-green-500');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-blue-500');
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);

            } catch (error) {
                console.error('Save error:', error);
                btn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i> Error!';
                btn.classList.add('bg-red-500');
                btn.disabled = false;
                lucide.createIcons();
            }
        };

        // Save Princess Profile Data (her.html)
        window.savePrincessProfile = async function() {
            const btn = document.getElementById('btn-save-princess-profile');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Saving...';
            btn.disabled = true;

            try {
                await setDoc(doc(db, "landing", "profileHer"), {
                    name: document.getElementById('input-princess-name').value,
                    title: document.getElementById('input-princess-title').value,
                    bio: document.getElementById('input-princess-bio').value,
                    photo: document.getElementById('princessProfilePreview').src,
                    gallery: window.princessGallery || [],
                    updatedAt: new Date()
                });

                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Saved!';
                btn.classList.remove('bg-pink-500');
                btn.classList.add('bg-green-500');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-pink-500');
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);

            } catch (error) {
                console.error('Save error:', error);
                btn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i> Error!';
                btn.classList.add('bg-red-500');
                btn.disabled = false;
                lucide.createIcons();
            }
        };

        // Save Profile Data (Anya/Princess)
        window.saveProfile = async function() {
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Saving...';
            btn.disabled = true;

            try {
                await setDoc(doc(db, "landing", "profile"), {
                    name: document.getElementById('input-name').value,
                    title: document.getElementById('input-title').value,
                    bio: document.getElementById('input-bio').value,
                    photo: document.getElementById('profilePreview').src,
                    tags: [
                        document.getElementById('input-tag1').value,
                        document.getElementById('input-tag2').value,
                        document.getElementById('input-tag3').value
                    ],
                    updatedAt: new Date()
                });

                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Saved!';
                btn.classList.remove('bg-brand-accent');
                btn.classList.add('bg-green-500');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-brand-accent');
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);

            } catch (error) {
                console.error('Save error:', error);
                btn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i> Error!';
                btn.classList.add('bg-red-500');
                btn.disabled = false;
                lucide.createIcons();
            }
        };

        // Save Memories Data
        window.saveMemories = async function() {
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Saving...';
            btn.disabled = true;

            try {
                const iconColors = ['pink', 'blue', 'yellow'];
                const icons = ['smile', 'heart', 'sparkles'];
                const items = [];
                
                for (let i = 1; i <= 3; i++) {
                    const title = document.getElementById(`mem${i}-title`);
                    const desc = document.getElementById(`mem${i}-desc`);
                    const img = document.getElementById(`mem${i}`);
                    
                    // Get image src, but only if it's a valid URL (not empty or blob)
                    let imageSrc = img?.src || null;
                    if (imageSrc && (imageSrc === '' || imageSrc === window.location.href || imageSrc.startsWith('blob:'))) {
                        imageSrc = null;
                    }
                    
                    items.push({
                        id: i,
                        title: title?.value || '',
                        description: desc?.value || '',
                        icon: icons[i-1],
                        iconColor: iconColors[i-1],
                        image: imageSrc,
                        order: i
                    });
                }
                
                console.log('Saving memories:', items);
                await setDoc(doc(db, "landing", "memories"), { items, updatedAt: new Date() });
                
                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Saved!';
                btn.classList.remove('bg-purple-500');
                btn.classList.add('bg-green-500');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-purple-500');
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);
                
            } catch (error) {
                console.error('Save memories error:', error);
                btn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i> Error!';
                btn.classList.add('bg-red-500');
                btn.disabled = false;
                lucide.createIcons();
                
                // Show detailed error
                setTimeout(() => {
                    alert('Failed to save: ' + error.message);
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-red-500');
                    btn.classList.add('bg-purple-500');
                }, 1000);
            }
        };

        // Save Gallery Data with better feedback
        window.saveGallery = async function() {
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Saving...';
            btn.disabled = true;

            try {
                const items = [];
                for (let i = 1; i <= 4; i++) {
                    const img = document.getElementById(`gal${i}`);
                    const caption = document.getElementById(`gal${i}-caption`);
                    
                    let imageSrc = img?.src || '';
                    if (imageSrc === window.location.href || imageSrc.startsWith('blob:')) {
                        imageSrc = '';
                    }
                    
                    items.push({
                        id: i,
                        url: imageSrc,
                        caption: caption?.value || '',
                        order: i
                    });
                }
                
                console.log('Saving gallery:', items);
                await setDoc(doc(db, "landing", "gallery"), { items, updatedAt: new Date() });
                
                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Saved!';
                btn.classList.remove('bg-blue-500');
                btn.classList.add('bg-green-500');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-blue-500');
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);
                
            } catch (error) {
                console.error('Save gallery error:', error);
                btn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i> Error!';
                btn.classList.add('bg-red-500');
                btn.disabled = false;
                lucide.createIcons();
                
                setTimeout(() => {
                    alert('Failed to save: ' + error.message);
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-red-500');
                    btn.classList.add('bg-blue-500');
                }, 1000);
            }
        };

        // Save Letter Data
        window.saveLetter = async function() {
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Saving...';
            btn.disabled = true;

            try {
                const letterData = {
                    title: document.getElementById('letter-title').value,
                    content: document.getElementById('letter-content').value,
                    quote: document.getElementById('letter-quote').value,
                    updatedAt: new Date()
                };
                
                console.log('Saving letter:', letterData);
                await setDoc(doc(db, "landing", "letter"), letterData);
                
                btn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Saved!';
                btn.classList.remove('bg-red-500');
                btn.classList.add('bg-green-500');
                lucide.createIcons();

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-red-500');
                    btn.disabled = false;
                    lucide.createIcons();
                }, 2000);
                
            } catch (error) {
                console.error('Save letter error:', error);
                btn.innerHTML = '<i data-lucide="x" class="w-4 h-4"></i> Error!';
                btn.disabled = false;
                lucide.createIcons();
                
                setTimeout(() => {
                    alert('Failed to save: ' + error.message);
                    btn.innerHTML = originalText;
                }, 1000);
            }
        };

        // Letter preview live update
        document.addEventListener('DOMContentLoaded', () => {
            const titleInput = document.getElementById('letter-title');
            const contentInput = document.getElementById('letter-content');
            const quoteInput = document.getElementById('letter-quote');
            
            if (titleInput) titleInput.addEventListener('input', () => {
                document.getElementById('letter-preview-title').textContent = titleInput.value || 'Hai Anya...';
            });
            if (contentInput) contentInput.addEventListener('input', () => {
                document.getElementById('letter-preview-content').textContent = contentInput.value || 'Your message will appear here...';
            });
            if (quoteInput) quoteInput.addEventListener('input', () => {
                document.getElementById('letter-preview-quote').textContent = '"' + (quoteInput.value || 'I love you, today and forever.') + '"';
            });
            
            // Load Sasuke image
            loadSasukeImage();
        });

        // Make loadDashboardData available globally for refresh
        window.loadDashboardData = loadDashboardData;
    </script>
    
    <style>
        /* Custom Dashboard Styles */
        .sidebar-glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(255, 255, 255, 0.3);
        }
        .dark .sidebar-glass {
            background: rgba(15, 23, 42, 0.8);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .nav-item.active {
            background: linear-gradient(to right, rgba(236, 72, 153, 0.1), rgba(219, 39, 119, 0.05));
            color: #db2777;
            border-right: 3px solid #db2777;
        }
        .dark .nav-item.active {
            background: linear-gradient(to right, rgba(244, 114, 182, 0.1), rgba(219, 39, 119, 0.05));
            color: #f472b6;
            border-right: 3px solid #f472b6;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-brand-blue via-slate-50 to-brand-pink dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 min-h-screen text-slate-700 dark:text-slate-300 overflow-x-hidden selection:bg-brand-accent selection:text-white">

    <!-- Gallery Upload Modal -->
    <div id="gallery-upload-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeGalleryUploadModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl overflow-hidden">
                <!-- Modal Header -->
                <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between">
                    <h3 id="gallery-modal-title" class="font-bold text-lg text-slate-800 dark:text-white">Add Photo</h3>
                    <button onclick="closeGalleryUploadModal()" class="text-slate-400 hover:text-red-500 transition">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <!-- Modal Body -->
                <div class="p-4 space-y-4">
                    <!-- Image Upload Area -->
                    <div class="relative">
                        <input type="file" id="gallery-file-input" accept="image/*" class="hidden" onchange="handleGalleryFileSelect(this)">
                        <label for="gallery-file-input" class="block cursor-pointer">
                            <div class="aspect-square rounded-xl border-2 border-dashed border-slate-300 dark:border-slate-600 hover:border-blue-500 dark:hover:border-blue-400 transition overflow-hidden relative">
                                <!-- Placeholder -->
                                <div id="gallery-upload-placeholder" class="absolute inset-0 flex flex-col items-center justify-center gap-3">
                                    <div class="w-16 h-16 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center">
                                        <i data-lucide="image-plus" class="w-8 h-8 text-slate-400"></i>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-slate-600 dark:text-slate-300 font-medium">Click to upload image</p>
                                        <p class="text-xs text-slate-400">JPG, PNG up to 5MB</p>
                                    </div>
                                </div>
                                <!-- Preview -->
                                <img id="gallery-upload-preview" src="" class="hidden w-full h-full object-cover">
                            </div>
                        </label>
                    </div>
                    
                    <!-- Caption Input -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Caption (optional)</label>
                        <input type="text" id="gallery-upload-caption" placeholder="Add a caption..." class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-700 text-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="p-4 border-t border-slate-200 dark:border-slate-700 flex gap-3">
                    <button onclick="closeGalleryUploadModal()" class="flex-1 px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition">
                        Cancel
                    </button>
                    <button id="gallery-submit-btn" onclick="submitGalleryPhoto()" class="flex-1 px-4 py-3 rounded-xl bg-blue-500 text-white font-medium hover:bg-blue-600 transition flex items-center justify-center gap-2">
                        <i data-lucide="upload" class="w-4 h-4"></i> Add Photo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-[100] bg-gradient-to-br from-brand-blue via-slate-50 to-brand-pink dark:from-slate-950 dark:via-slate-900 dark:to-slate-950 flex items-center justify-center">
        <div class="text-center">
            <div class="w-12 h-12 border-4 border-brand-accent border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-slate-500 dark:text-slate-400 font-medium">Authenticating...</p>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="sidebarOverlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden transition-opacity duration-300 backdrop-blur-sm"></div>

    <div class="flex min-h-screen relative">

        <!-- SIDEBAR -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 sidebar-glass transform -translate-x-full transition-transform duration-300 ease-in-out md:translate-x-0 md:static md:flex flex-col md:h-screen md:sticky md:top-0 overflow-y-auto">
            
            <!-- Sidebar Header -->
            <div class="h-20 flex items-center justify-between px-6 border-b border-slate-200/50 dark:border-slate-700/50">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-pink-500 to-purple-500 flex items-center justify-center text-white shadow-lg shadow-pink-500/30">
                        <i data-lucide="layout-dashboard" class="w-4 h-4"></i>
                    </div>
                    <div>
                        <h1 class="font-serif font-bold text-lg text-slate-800 dark:text-white leading-none">World of Anya</h1>
                        <span class="text-[10px] uppercase tracking-widest text-slate-500 font-medium">Control Center</span>
                    </div>
                </div>
                <button onclick="toggleSidebar()" class="md:hidden text-slate-400 hover:text-red-500 transition">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar">
                <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 mt-2">Analytics</p>
                <a href="#overview" class="nav-item active flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all hover:bg-white/50 dark:hover:bg-slate-800/50 group">
                    <i data-lucide="bar-chart-2" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Overview
                </a>
                
                <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 mt-6">Landing Page</p>
                <a href="#section-hero" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-brand-accent dark:hover:text-brand-accentLight hover:bg-white/50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-all group">
                    <i data-lucide="user" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Profile Section
                    <span class="ml-auto text-[10px] text-slate-400">index.html</span>
                </a>
                <a href="#section-gallery" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-brand-accent dark:hover:text-brand-accentLight hover:bg-white/50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-all group">
                    <i data-lucide="image" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Landing Gallery
                </a>
                <a href="#section-memories" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-brand-accent dark:hover:text-brand-accentLight hover:bg-white/50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-all group">
                    <i data-lucide="sparkles" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Memories
                </a>
                <a href="#section-letter" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-brand-accent dark:hover:text-brand-accentLight hover:bg-white/50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-all group">
                    <i data-lucide="mail-heart" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Secret Letter
                </a>
                
                <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 mt-6">Profile Pages</p>
                <a href="#section-princess-profile" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-pink-500 dark:hover:text-pink-400 hover:bg-pink-50/50 dark:hover:bg-pink-900/20 rounded-xl font-medium transition-all group">
                    <i data-lucide="heart" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Princess Profile
                    <span class="ml-auto text-[10px] text-pink-500">her.html</span>
                </a>
                <a href="#section-rey-profile" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-blue-500 dark:hover:text-blue-400 hover:bg-blue-50/50 dark:hover:bg-blue-900/20 rounded-xl font-medium transition-all group">
                    <i data-lucide="shield" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Guardian Profile
                    <span class="ml-auto text-[10px] text-blue-500">him.html</span>
                </a>
                
                <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 mt-6">Universe</p>
                <a href="#" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-brand-accent dark:hover:text-brand-accentLight hover:bg-white/50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-all group">
                    <i data-lucide="camera" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    Stories & Feed
                    <span class="ml-auto text-[10px] bg-brand-accent text-white px-1.5 py-0.5 rounded-full">New</span>
                </a>

                <p class="px-4 text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 mt-6">System</p>
                <a href="../index.html" target="_blank" class="nav-item flex items-center gap-3 px-4 py-3 text-slate-600 dark:text-slate-400 hover:text-brand-accent dark:hover:text-brand-accentLight hover:bg-white/50 dark:hover:bg-slate-800/50 rounded-xl font-medium transition-all group">
                    <i data-lucide="external-link" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                    View Live Site
                </a>
                <button onclick="logout()" class="w-full nav-item flex items-center gap-3 px-4 py-3 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl font-medium transition-all group mt-4">
                    <i data-lucide="log-out" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                    Logout
                </button>
            </nav>
            
            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-slate-200/50 dark:border-slate-700/50">
                <div class="glass-card p-3 rounded-xl flex items-center gap-3">
                    <div class="relative">
                        <img id="sidebarAdminAvatar" src="https://ui-avatars.com/api/?name=Rey&background=0D8ABC&color=fff" class="w-10 h-10 rounded-full border-2 border-white dark:border-slate-700">
                        <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-slate-800 rounded-full"></span>
                    </div>
                    <div class="overflow-hidden">
                        <p id="sidebarAdminName" class="text-sm font-bold text-slate-800 dark:text-white truncate">Admin</p>
                        <p class="text-xs text-slate-500 truncate">Super Admin</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 w-full md:w-auto p-3 md:p-8 space-y-6 md:space-y-8 overflow-x-hidden">
            
            <!-- Mobile Header -->
            <div class="md:hidden flex justify-between items-center mb-4 glass-card p-3 rounded-xl sticky top-4 z-20">
                <div class="flex items-center gap-2">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 text-brand-accent"></i>
                    <span class="font-serif font-bold text-base">Dashboard</span>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="toggleTheme()" class="p-2 rounded-full bg-white/50 dark:bg-slate-800/50 hover:scale-105 transition-transform">
                        <i data-lucide="sun" class="w-4 h-4 text-amber-400 hidden dark:block"></i>
                        <i data-lucide="moon" class="w-4 h-4 text-slate-600 block dark:hidden"></i>
                    </button>
                    <button onclick="toggleSidebar()" class="p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition">
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <!-- Desktop Header -->
            <div class="hidden md:flex justify-between items-end" data-aos="fade-down">
                <div>
                    <h1 class="text-3xl font-serif font-bold text-slate-800 dark:text-white mb-1">Welcome back, Rey! ðŸ‘‹</h1>
                    <p class="text-slate-500 dark:text-slate-400">Here's what's happening in your universe today.</p>
                </div>
                <div class="flex gap-4">
                    <button onclick="toggleTheme()" class="p-3 rounded-full glass-card hover:scale-105 transition-transform group">
                        <i data-lucide="sun" class="w-5 h-5 text-amber-400 hidden dark:block group-hover:rotate-90 transition-transform"></i>
                        <i data-lucide="moon" class="w-5 h-5 text-slate-600 block dark:hidden group-hover:-rotate-12 transition-transform"></i>
                    </button>
                    <button class="p-3 rounded-full glass-card hover:scale-105 transition-transform relative">
                        <i data-lucide="bell" class="w-5 h-5 text-slate-600 dark:text-slate-300"></i>
                        <span class="absolute top-2 right-2.5 w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 md:gap-6" id="overview">
                <div class="glass-card p-4 md:p-6 rounded-2xl flex items-center justify-between group hover:-translate-y-1 transition-transform duration-300" data-aos="fade-up" data-aos-delay="100">
                    <div>
                        <p class="text-xs md:text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">Total Visits</p>
                        <h3 id="stat-visits" class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white">--</h3>
                        <p class="text-xs text-green-500 flex items-center gap-1 mt-2">
                            <i data-lucide="trending-up" class="w-3 h-3"></i> +12% this week
                        </p>
                    </div>
                    <div class="p-3 md:p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl md:rounded-2xl text-blue-500 group-hover:scale-110 transition-transform">
                        <i data-lucide="eye" class="w-6 h-6 md:w-8 md:h-8"></i>
                    </div>
                </div>
                
                <div class="glass-card p-4 md:p-6 rounded-2xl flex items-center justify-between group hover:-translate-y-1 transition-transform duration-300" data-aos="fade-up" data-aos-delay="200">
                    <div>
                        <p class="text-xs md:text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">Memories Stored</p>
                        <h3 id="stat-memories" class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white">--</h3>
                        <p class="text-xs text-pink-500 flex items-center gap-1 mt-2">
                            <i data-lucide="plus" class="w-3 h-3"></i> 3 new today
                        </p>
                    </div>
                    <div class="p-3 md:p-4 bg-pink-50 dark:bg-pink-900/30 rounded-xl md:rounded-2xl text-pink-500 group-hover:scale-110 transition-transform">
                        <i data-lucide="heart" class="w-6 h-6 md:w-8 md:h-8"></i>
                    </div>
                </div>
                
                <div class="glass-card p-4 md:p-6 rounded-2xl flex items-center justify-between group hover:-translate-y-1 transition-transform duration-300 sm:col-span-2 md:col-span-1" data-aos="fade-up" data-aos-delay="300">
                    <div>
                        <p class="text-xs md:text-sm font-medium text-slate-500 dark:text-slate-400 mb-1">Days Together</p>
                        <h3 id="stat-days" class="text-2xl md:text-3xl font-bold text-slate-800 dark:text-white">--</h3>
                        <p class="text-xs text-purple-500 flex items-center gap-1 mt-2">
                            <i data-lucide="calendar" class="w-3 h-3"></i> Forever to go
                        </p>
                    </div>
                    <div class="p-3 md:p-4 bg-purple-50 dark:bg-purple-900/30 rounded-xl md:rounded-2xl text-purple-500 group-hover:scale-110 transition-transform">
                        <i data-lucide="hourglass" class="w-6 h-6 md:w-8 md:h-8"></i>
                    </div>
                </div>
            </div>

            <!-- Profile Section (for Landing Page index.html) -->
            <section id="section-hero" class="glass-card rounded-3xl overflow-hidden" data-aos="fade-up">
                <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50 flex justify-between items-center bg-white/30 dark:bg-slate-800/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-pink-100 dark:bg-pink-900/30 rounded-lg text-pink-500">
                            <i data-lucide="user" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-base md:text-lg text-slate-800 dark:text-white">Profile Section</h3>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Hero & About section on Landing Page</p>
                        </div>
                    </div>
                    <button onclick="saveProfile()" class="px-3 py-2 md:px-4 bg-brand-accent hover:bg-pink-600 text-white text-xs md:text-sm font-medium rounded-full shadow-lg shadow-pink-500/30 transition-transform hover:scale-105 flex items-center gap-1 md:gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i> Save Changes
                    </button>
                </div>
                
                <div class="p-4 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                    <div class="md:col-span-1">
                        <label class="block text-sm font-bold mb-3 text-slate-700 dark:text-slate-300">Profile Photo</label>
                        <div class="relative group rounded-2xl overflow-hidden aspect-[3/4] border-4 border-white dark:border-slate-700 shadow-xl">
                            <img id="profilePreview" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                            
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center cursor-pointer backdrop-blur-sm">
                                <button class="bg-white/90 text-slate-900 px-5 py-2.5 rounded-full text-sm font-bold flex items-center gap-2 shadow-lg hover:bg-white transition">
                                    <i data-lucide="upload" class="w-4 h-4"></i> Change Photo
                                </button>
                            </div>
                            <input type="file" class="absolute inset-0 opacity-0 cursor-pointer" onchange="updatePreview(this, 'profilePreview')">
                        </div>
                        <p class="text-xs text-center text-slate-400 mt-3">Recommended: Portrait 3:4</p>
                    </div>
                    
                    <div class="md:col-span-2 space-y-4 md:space-y-6">
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Display Name</label>
                            <input type="text" id="input-name" value="" placeholder="Zalfa Nazhifah" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-brand-accent focus:border-transparent outline-none transition backdrop-blur-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Title / Role</label>
                            <input type="text" id="input-title" value="" placeholder="The Main Character" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-brand-accent focus:border-transparent outline-none transition backdrop-blur-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Bio / Quote</label>
                            <textarea id="input-bio" rows="3" placeholder="She is the poem I never knew how to write..." class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-brand-accent focus:border-transparent outline-none transition backdrop-blur-sm resize-none"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Highlight Tags</label>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-slate-400">#</span>
                                    <input type="text" id="input-tag1" value="" class="w-full pl-7 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-brand-accent outline-none transition text-sm">
                                </div>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-slate-400">#</span>
                                    <input type="text" id="input-tag2" value="" class="w-full pl-7 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-brand-accent outline-none transition text-sm">
                                </div>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-slate-400">#</span>
                                    <input type="text" id="input-tag3" value="" class="w-full pl-7 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-brand-accent outline-none transition text-sm">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Princess Profile Section (for her.html) -->
            <section id="section-princess-profile" class="glass-card rounded-3xl overflow-hidden" data-aos="fade-up">
                <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50 flex justify-between items-center bg-white/30 dark:bg-slate-800/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-pink-100 dark:bg-pink-900/30 rounded-lg text-pink-500">
                            <i data-lucide="heart" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-base md:text-lg text-slate-800 dark:text-white">Princess Profile</h3>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Data for her.html page</p>
                        </div>
                    </div>
                    <button id="btn-save-princess-profile" onclick="savePrincessProfile()" class="px-3 py-2 md:px-4 bg-pink-500 hover:bg-pink-600 text-white text-xs md:text-sm font-medium rounded-full shadow-lg shadow-pink-500/30 transition-transform hover:scale-105 flex items-center gap-1 md:gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i> Save Changes
                    </button>
                </div>
                
                <div class="p-4 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                    <!-- Photo Section -->
                    <div class="md:col-span-1">
                        <label class="block text-sm font-bold mb-3 text-slate-700 dark:text-slate-300">Profile Photo</label>
                        <div class="relative group rounded-2xl overflow-hidden aspect-[3/4] border-4 border-white dark:border-slate-700 shadow-xl">
                            <div class="absolute inset-0 bg-slate-200 dark:bg-slate-700 animate-pulse" id="princessPhotoSkeleton"></div>
                            <img id="princessProfilePreview" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="w-full h-full object-cover transition duration-500 group-hover:scale-110 opacity-0"
                                onload="if(this.src.indexOf('data:image/gif') === -1) { this.classList.remove('opacity-0'); document.getElementById('princessPhotoSkeleton')?.classList.add('hidden'); }">
                            
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center cursor-pointer backdrop-blur-sm">
                                <button class="bg-white/90 text-slate-900 px-5 py-2.5 rounded-full text-sm font-bold flex items-center gap-2 shadow-lg hover:bg-white transition">
                                    <i data-lucide="upload" class="w-4 h-4"></i> Change Photo
                                </button>
                            </div>
                            <input type="file" class="absolute inset-0 opacity-0 cursor-pointer" onchange="updatePreview(this, 'princessProfilePreview')">
                        </div>
                        <p class="text-xs text-center text-slate-400 mt-3">Recommended: Portrait 3:4</p>
                    </div>
                    
                    <!-- Form Section -->
                    <div class="md:col-span-2 space-y-4 md:space-y-6">
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Display Name</label>
                            <input type="text" id="input-princess-name" value="Zalfa Nazhifah" placeholder="Zalfa Nazhifah" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-pink-500 focus:border-transparent outline-none transition backdrop-blur-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Title / Role</label>
                            <input type="text" id="input-princess-title" value="The Main Character" placeholder="The Main Character" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-pink-500 focus:border-transparent outline-none transition backdrop-blur-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Bio / Quote</label>
                            <textarea id="input-princess-bio" rows="3" placeholder="She is the poem I never knew how to write..." class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-pink-500 focus:border-transparent outline-none transition backdrop-blur-sm resize-none">She is the poem I never knew how to write, and this life is the paper.</textarea>
                        </div>
                        
                        <!-- Role Info Badge -->
                        <div class="p-4 bg-gradient-to-r from-pink-50 to-purple-50 dark:from-pink-900/20 dark:to-purple-900/20 rounded-xl border border-pink-200/50 dark:border-pink-500/20">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-pink-400 to-purple-500 flex items-center justify-center">
                                    <i data-lucide="heart" class="w-5 h-5 text-white"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-sm text-slate-800 dark:text-white">The Princess</p>
                                    <p class="text-xs text-slate-500 dark:text-slate-400">The center of this universe</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sasuke Image Upload (Love Progress 0% Marker) -->
                <div class="p-4 md:p-8 border-t border-slate-200/50 dark:border-slate-700/50">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">ðŸ–¤</span>
                            <div>
                                <h4 class="font-bold text-slate-800 dark:text-white">Sasuke Image</h4>
                                <p class="text-xs text-slate-400">0% marker for Love Progress (landing/sasukeImage)</p>
                            </div>
                        </div>
                        <button onclick="saveSasukeImage()" id="saveSasukeBtn" class="px-4 py-2 bg-slate-700 hover:bg-slate-800 text-white text-sm font-medium rounded-full shadow-lg transition flex items-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i> Save Image
                        </button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold mb-3 text-slate-700 dark:text-slate-300">Upload Sasuke Image</label>
                            <div class="relative group rounded-xl overflow-hidden aspect-square border-4 border-slate-300 dark:border-slate-700 shadow-xl max-w-xs mx-auto">
                                <img id="sasukePreview" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                                
                                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center cursor-pointer backdrop-blur-sm">
                                    <button type="button" class="bg-white/90 text-slate-900 px-5 py-2.5 rounded-full text-sm font-bold flex items-center gap-2 shadow-lg hover:bg-white transition">
                                        <i data-lucide="upload" class="w-4 h-4"></i> Change Image
                                    </button>
                                </div>
                                <input type="file" id="sasukeImageInput" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" onchange="updateSasukePreview(this)">
                            </div>
                            <p class="text-xs text-center text-slate-400 mt-3">Recommended: Square 1:1</p>
                        </div>
                        
                        <div class="flex flex-col justify-center">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Name/Label</label>
                                    <input type="text" id="sasukeName" value="Sasuke Uchiha" placeholder="Sasuke" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-slate-500 focus:border-transparent outline-none transition">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Description</label>
                                    <input type="text" id="sasukeDescription" value="0% - Stranger/Friendzone marker" placeholder="Description" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-slate-500 focus:border-transparent outline-none transition">
                                </div>
                                
                                <div class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl">
                                    <p class="text-xs text-slate-600 dark:text-slate-400">
                                        <strong>Info:</strong> Image ini akan muncul sebagai marker 0% di Love Progress section. 
                                        Upload gambar Sasuke atau karakter lain yang mewakili "friendzone".
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Section -->
                <div class="p-4 md:p-8 border-t border-slate-200/50 dark:border-slate-700/50">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <i data-lucide="grid-3x3" class="w-5 h-5 text-pink-500"></i>
                            <h4 class="font-bold text-slate-800 dark:text-white">Profile Gallery</h4>
                            <span class="text-xs text-slate-400">Photos shown on her.html</span>
                        </div>
                        <button onclick="addPrincessGalleryPhoto()" class="px-3 py-1.5 bg-pink-100 dark:bg-pink-900/30 text-pink-600 dark:text-pink-400 text-xs font-medium rounded-full hover:bg-pink-200 dark:hover:bg-pink-900/50 transition flex items-center gap-1">
                            <i data-lucide="plus" class="w-3 h-3"></i> Add Photo
                        </button>
                    </div>
                    
                    <div id="princess-gallery-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <!-- Gallery items will be loaded here -->
                        <div class="aspect-square rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse"></div>
                        <div class="aspect-square rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse"></div>
                        <div class="aspect-square rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse"></div>
                        <div class="aspect-square rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse"></div>
                    </div>
                </div>
            </section>

            <!-- Rey Profile Section (Guardian) -->
            <section id="section-rey-profile" class="glass-card rounded-3xl overflow-hidden" data-aos="fade-up">
                <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50 flex justify-between items-center bg-white/30 dark:bg-slate-800/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-500">
                            <i data-lucide="shield" class="w-5 h-5"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-base md:text-lg text-slate-800 dark:text-white">Guardian Profile</h3>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Rey's Profile Section</p>
                        </div>
                    </div>
                    <button id="btn-save-rey-profile" onclick="saveReyProfile()" class="px-3 py-2 md:px-4 bg-blue-500 hover:bg-blue-600 text-white text-xs md:text-sm font-medium rounded-full shadow-lg shadow-blue-500/30 transition-transform hover:scale-105 flex items-center gap-1 md:gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i> Save Changes
                    </button>
                </div>
                
                <div class="p-4 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                    <!-- Photo Section -->
                    <div class="md:col-span-1">
                        <label class="block text-sm font-bold mb-3 text-slate-700 dark:text-slate-300">Profile Photo</label>
                        <div class="relative group rounded-2xl overflow-hidden aspect-[3/4] border-4 border-white dark:border-slate-700 shadow-xl">
                            <div class="absolute inset-0 bg-slate-200 dark:bg-slate-700 animate-pulse" id="reyPhotoSkeleton"></div>
                            <img id="reyProfilePreview" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="w-full h-full object-cover transition duration-500 group-hover:scale-110 opacity-0"
                                onload="if(this.src.indexOf('data:image/gif') === -1) { this.classList.remove('opacity-0'); document.getElementById('reyPhotoSkeleton')?.classList.add('hidden'); }">
                            
                            <div id="rey-photo-overlay" class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center cursor-pointer backdrop-blur-sm">
                                <button class="bg-white/90 text-slate-900 px-5 py-2.5 rounded-full text-sm font-bold flex items-center gap-2 shadow-lg hover:bg-white transition">
                                    <i data-lucide="upload" class="w-4 h-4"></i> Change Photo
                                </button>
                            </div>
                            <input type="file" id="rey-photo-input" class="absolute inset-0 opacity-0 cursor-pointer" onchange="updatePreview(this, 'reyProfilePreview')">
                        </div>
                        <p class="text-xs text-center text-slate-400 mt-3">Recommended: Portrait 3:4</p>
                        
                        <!-- Stickers Section (for Anya to add) -->
                        <div class="mt-6">
                            <label class="block text-sm font-bold mb-3 text-slate-700 dark:text-slate-300 flex items-center gap-2">
                                <i data-lucide="sparkles" class="w-4 h-4 text-pink-500"></i>
                                Stickers from Anya
                            </label>
                            <div id="rey-stickers-display" class="flex flex-wrap gap-2 p-3 bg-slate-50 dark:bg-slate-800/50 rounded-xl min-h-[60px] items-center justify-center">
                                <span class="text-slate-400 text-xs" id="no-stickers-msg">No stickers yet ðŸ’•</span>
                            </div>
                            
                            <!-- Sticker Picker (only visible for Anya) -->
                            <div id="sticker-picker" class="hidden mt-3">
                                <p class="text-xs text-slate-500 dark:text-slate-400 mb-2">Add a sticker for Rey:</p>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="addSticker('â¤ï¸')" class="text-2xl hover:scale-125 transition">â¤ï¸</button>
                                    <button onclick="addSticker('ðŸ’•')" class="text-2xl hover:scale-125 transition">ðŸ’•</button>
                                    <button onclick="addSticker('âœ¨')" class="text-2xl hover:scale-125 transition">âœ¨</button>
                                    <button onclick="addSticker('ðŸŒŸ')" class="text-2xl hover:scale-125 transition">ðŸŒŸ</button>
                                    <button onclick="addSticker('ðŸ¥°')" class="text-2xl hover:scale-125 transition">ðŸ¥°</button>
                                    <button onclick="addSticker('ðŸ˜˜')" class="text-2xl hover:scale-125 transition">ðŸ˜˜</button>
                                    <button onclick="addSticker('ðŸ’–')" class="text-2xl hover:scale-125 transition">ðŸ’–</button>
                                    <button onclick="addSticker('ðŸ¦‹')" class="text-2xl hover:scale-125 transition">ðŸ¦‹</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Form Section -->
                    <div class="md:col-span-2 space-y-4 md:space-y-6">
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Display Name</label>
                            <input type="text" id="input-rey-name" value="" placeholder="M Reyvan Purnama" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition backdrop-blur-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Title / Role</label>
                            <input type="text" id="input-rey-title" value="" placeholder="The Observer" class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition backdrop-blur-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Bio / Quote</label>
                            <textarea id="input-rey-bio" rows="3" placeholder="I see the universe in your eyes..." class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition backdrop-blur-sm resize-none"></textarea>
                        </div>
                        
                        <!-- Role Info Badge -->
                        <div class="p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl border border-blue-200/50 dark:border-blue-500/20">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-400 to-cyan-500 flex items-center justify-center">
                                    <i data-lucide="shield" class="w-5 h-5 text-white"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-sm text-slate-800 dark:text-white">The Guardian</p>
                                    <p class="text-xs text-slate-500 dark:text-slate-400">Protector of this universe</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Section -->
                <div class="p-4 md:p-8 border-t border-slate-200/50 dark:border-slate-700/50">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <i data-lucide="grid-3x3" class="w-5 h-5 text-blue-500"></i>
                            <h4 class="font-bold text-slate-800 dark:text-white">Profile Gallery</h4>
                            <span class="text-xs text-slate-400">Photos shown on him.html</span>
                        </div>
                        <button onclick="addGuardianGalleryPhoto()" class="px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-xs font-medium rounded-full hover:bg-blue-200 dark:hover:bg-blue-900/50 transition flex items-center gap-1">
                            <i data-lucide="plus" class="w-3 h-3"></i> Add Photo
                        </button>
                    </div>
                    
                    <div id="guardian-gallery-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <!-- Gallery items will be loaded here -->
                        <div class="aspect-square rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse"></div>
                        <div class="aspect-square rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse"></div>
                        <div class="aspect-square rounded-xl bg-slate-100 dark:bg-slate-800 animate-pulse"></div>
                    </div>
                </div>
            </section>

            <!-- Gallery Section -->
            <section id="section-gallery" class="glass-card rounded-3xl overflow-hidden" data-aos="fade-up">
                <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50 flex justify-between items-center bg-white/30 dark:bg-slate-800/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-500">
                            <i data-lucide="image" class="w-5 h-5"></i>
                        </div>
                        <h3 class="font-bold text-base md:text-lg text-slate-800 dark:text-white">Landing Gallery</h3>
                    </div>
                    <button onclick="saveGallery()" class="px-3 py-2 md:px-4 bg-blue-500 hover:bg-blue-600 text-white text-xs md:text-sm font-medium rounded-full shadow-lg shadow-blue-500/30 transition-transform hover:scale-105 flex items-center gap-1 md:gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i> Save Gallery
                    </button>
                </div>
                
                <div class="p-4 md:p-6 grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                    <!-- Gallery Item 1 -->
                    <div class="relative group rounded-2xl overflow-hidden aspect-square border border-slate-200 dark:border-slate-700 shadow-md">
                        <img id="gal1" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center p-4 text-center backdrop-blur-[2px]">
                            <input type="file" class="hidden" id="file-gal1" onchange="updatePreview(this, 'gal1')">
                            <label for="file-gal1" class="cursor-pointer w-10 h-10 rounded-full bg-white/20 hover:bg-brand-accent flex items-center justify-center text-white transition mb-3 backdrop-blur-md">
                                <i data-lucide="edit-2" class="w-5 h-5"></i>
                            </label>
                            <input type="text" id="gal1-caption" value="" class="bg-transparent border-b border-white/30 text-white text-xs text-center w-full focus:outline-none focus:border-brand-accent placeholder-white/50 py-1 transition-colors" placeholder="Caption...">
                        </div>
                        <span class="absolute top-2 left-2 bg-black/50 text-white text-[10px] font-bold px-2 py-1 rounded-lg backdrop-blur-md border border-white/10">01</span>
                    </div>

                    <!-- Gallery Item 2 -->
                    <div class="relative group rounded-2xl overflow-hidden aspect-square border border-slate-200 dark:border-slate-700 shadow-md">
                        <img id="gal2" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center p-4 text-center backdrop-blur-[2px]">
                            <input type="file" class="hidden" id="file-gal2" onchange="updatePreview(this, 'gal2')">
                            <label for="file-gal2" class="cursor-pointer w-10 h-10 rounded-full bg-white/20 hover:bg-brand-accent flex items-center justify-center text-white transition mb-3 backdrop-blur-md">
                                <i data-lucide="edit-2" class="w-5 h-5"></i>
                            </label>
                            <input type="text" id="gal2-caption" value="" class="bg-transparent border-b border-white/30 text-white text-xs text-center w-full focus:outline-none focus:border-brand-accent placeholder-white/50 py-1 transition-colors" placeholder="Caption...">
                        </div>
                        <span class="absolute top-2 left-2 bg-black/50 text-white text-[10px] font-bold px-2 py-1 rounded-lg backdrop-blur-md border border-white/10">02</span>
                    </div>

                    <!-- Gallery Item 3 -->
                    <div class="relative group rounded-2xl overflow-hidden aspect-square border border-slate-200 dark:border-slate-700 shadow-md">
                        <img id="gal3" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center p-4 text-center backdrop-blur-[2px]">
                            <input type="file" class="hidden" id="file-gal3" onchange="updatePreview(this, 'gal3')">
                            <label for="file-gal3" class="cursor-pointer w-10 h-10 rounded-full bg-white/20 hover:bg-brand-accent flex items-center justify-center text-white transition mb-3 backdrop-blur-md">
                                <i data-lucide="edit-2" class="w-5 h-5"></i>
                            </label>
                            <input type="text" id="gal3-caption" value="" class="bg-transparent border-b border-white/30 text-white text-xs text-center w-full focus:outline-none focus:border-brand-accent placeholder-white/50 py-1 transition-colors" placeholder="Caption...">
                        </div>
                        <span class="absolute top-2 left-2 bg-black/50 text-white text-[10px] font-bold px-2 py-1 rounded-lg backdrop-blur-md border border-white/10">03</span>
                    </div>

                    <!-- Gallery Item 4 -->
                    <div class="relative group rounded-2xl overflow-hidden aspect-square border border-slate-200 dark:border-slate-700 shadow-md">
                        <img id="gal4" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                        <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center p-4 text-center backdrop-blur-[2px]">
                            <input type="file" class="hidden" id="file-gal4" onchange="updatePreview(this, 'gal4')">
                            <label for="file-gal4" class="cursor-pointer w-10 h-10 rounded-full bg-white/20 hover:bg-brand-accent flex items-center justify-center text-white transition mb-3 backdrop-blur-md">
                                <i data-lucide="edit-2" class="w-5 h-5"></i>
                            </label>
                            <input type="text" id="gal4-caption" value="" class="bg-transparent border-b border-white/30 text-white text-xs text-center w-full focus:outline-none focus:border-brand-accent placeholder-white/50 py-1 transition-colors" placeholder="Caption...">
                        </div>
                        <span class="absolute top-2 left-2 bg-black/50 text-white text-[10px] font-bold px-2 py-1 rounded-lg backdrop-blur-md border border-white/10">04</span>
                    </div>
                </div>
            </section>

            <!-- Memories Section -->
            <section id="section-memories" class="glass-card rounded-3xl overflow-hidden" data-aos="fade-up">
                <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50 flex justify-between items-center bg-white/30 dark:bg-slate-800/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-500">
                            <i data-lucide="sparkles" class="w-5 h-5"></i>
                        </div>
                        <h3 class="font-bold text-base md:text-lg text-slate-800 dark:text-white">Immortalized Memories</h3>
                    </div>
                    <button onclick="saveMemories()" class="px-3 py-2 md:px-4 bg-purple-500 hover:bg-purple-600 text-white text-xs md:text-sm font-medium rounded-full shadow-lg shadow-purple-500/30 transition-transform hover:scale-105 flex items-center gap-1 md:gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i> Save Memories
                    </button>
                </div>

                <div class="p-4 md:p-6 space-y-4 md:space-y-6">
                    <!-- Memory 1 -->
                    <div class="flex flex-col md:flex-row gap-4 md:gap-6 p-3 md:p-4 border border-slate-200/50 dark:border-slate-700/50 rounded-2xl bg-white/40 dark:bg-slate-900/40 hover:bg-white/60 dark:hover:bg-slate-800/60 transition-colors">
                        <div class="w-full md:w-40 h-40 md:h-32 rounded-xl overflow-hidden bg-slate-200 relative group shrink-0 shadow-md">
                            <img id="mem1" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                             <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center backdrop-blur-[1px]">
                                <label class="cursor-pointer w-10 h-10 rounded-full bg-white/20 hover:bg-brand-accent flex items-center justify-center text-white transition backdrop-blur-md">
                                    <i data-lucide="upload" class="w-5 h-5"></i>
                                    <input type="file" class="hidden" onchange="updatePreview(this, 'mem1')">
                                </label>
                            </div>
                        </div>
                        <div class="flex-1 space-y-4">
                            <div class="flex items-center gap-3">
                                <div class="p-1.5 bg-pink-100 dark:bg-pink-900/30 rounded-lg text-pink-500">
                                    <i data-lucide="smile" class="w-4 h-4"></i>
                                </div>
                                <input type="text" id="mem1-title" value="" class="w-full font-bold text-lg bg-transparent border-b border-transparent hover:border-slate-300 focus:border-brand-accent outline-none transition-colors text-slate-800 dark:text-white" placeholder="Memory Title...">
                            </div>
                            <textarea id="mem1-desc" class="w-full text-sm text-slate-600 dark:text-slate-400 bg-white/50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:ring-2 focus:ring-brand-accent outline-none transition resize-none" rows="2" placeholder="Describe this memory..."></textarea>
                        </div>
                    </div>

                    <!-- Memory 2 -->
                    <div class="flex flex-col md:flex-row gap-4 md:gap-6 p-3 md:p-4 border border-slate-200/50 dark:border-slate-700/50 rounded-2xl bg-white/40 dark:bg-slate-900/40 hover:bg-white/60 dark:hover:bg-slate-800/60 transition-colors">
                        <div class="w-full md:w-40 h-40 md:h-32 rounded-xl overflow-hidden bg-slate-200 relative group shrink-0 shadow-md">
                            <img id="mem2" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110">
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center backdrop-blur-[1px]">
                                <label class="cursor-pointer w-10 h-10 rounded-full bg-white/20 hover:bg-brand-accent flex items-center justify-center text-white transition backdrop-blur-md">
                                    <i data-lucide="upload" class="w-5 h-5"></i>
                                    <input type="file" class="hidden" onchange="updatePreview(this, 'mem2')">
                                </label>
                            </div>
                        </div>
                        <div class="flex-1 space-y-4">
                            <div class="flex items-center gap-3">
                                <div class="p-1.5 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-500">
                                    <i data-lucide="heart" class="w-4 h-4"></i>
                                </div>
                                <input type="text" id="mem2-title" value="" class="w-full font-bold text-lg bg-transparent border-b border-transparent hover:border-slate-300 focus:border-brand-accent outline-none transition-colors text-slate-800 dark:text-white" placeholder="Memory Title...">
                            </div>
                            <textarea id="mem2-desc" class="w-full text-sm text-slate-600 dark:text-slate-400 bg-white/50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:ring-2 focus:ring-brand-accent outline-none transition resize-none" rows="2" placeholder="Describe this memory..."></textarea>
                        </div>
                    </div>

                    <!-- Memory 3 (Empty) -->
                    <div class="flex flex-col md:flex-row gap-4 md:gap-6 p-3 md:p-4 border border-slate-200/50 dark:border-slate-700/50 rounded-2xl bg-white/40 dark:bg-slate-900/40 hover:bg-white/60 dark:hover:bg-slate-800/60 transition-colors">
                        <div class="w-full md:w-40 h-40 md:h-32 rounded-xl overflow-hidden bg-slate-100 dark:bg-slate-800 flex items-center justify-center relative group shrink-0 shadow-inner border-2 border-dashed border-slate-300 dark:border-slate-600">
                            <img id="mem3" src="" class="w-full h-full object-cover transition duration-500 group-hover:scale-110 hidden">
                            <span id="mem3-placeholder" class="text-4xl text-slate-300 dark:text-slate-600 font-serif group-hover:scale-110 transition-transform">?</span>
                            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center backdrop-blur-[1px]">
                                <label class="cursor-pointer w-10 h-10 rounded-full bg-white/20 hover:bg-brand-accent flex items-center justify-center text-white transition backdrop-blur-md">
                                    <i data-lucide="upload" class="w-5 h-5"></i>
                                    <input type="file" class="hidden" onchange="updatePreview(this, 'mem3')">
                                </label>
                            </div>
                        </div>
                        <div class="flex-1 space-y-4">
                            <div class="flex items-center gap-3">
                                <div class="p-1.5 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg text-yellow-500">
                                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                                </div>
                                <input type="text" id="mem3-title" value="" class="w-full font-bold text-lg bg-transparent border-b border-transparent hover:border-slate-300 focus:border-brand-accent outline-none transition-colors text-slate-800 dark:text-white" placeholder="Memory Title...">
                            </div>
                            <textarea id="mem3-desc" class="w-full text-sm text-slate-600 dark:text-slate-400 bg-white/50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-3 focus:ring-2 focus:ring-brand-accent outline-none transition resize-none" rows="2" placeholder="Describe this memory..."></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Letter Section -->
            <section id="section-letter" class="glass-card rounded-3xl overflow-hidden" data-aos="fade-up">
                <div class="p-6 border-b border-slate-200/50 dark:border-slate-700/50 flex justify-between items-center bg-white/30 dark:bg-slate-800/30">
                    <div class="flex items-center gap-3">
                        <div class="p-2 bg-red-100 dark:bg-red-900/30 rounded-lg text-red-500">
                            <i data-lucide="mail-heart" class="w-5 h-5"></i>
                        </div>
                        <h3 class="font-bold text-base md:text-lg text-slate-800 dark:text-white">Sebuah Pesan Kecil</h3>
                    </div>
                    <button onclick="saveLetter()" class="px-3 py-2 md:px-4 bg-red-500 hover:bg-red-600 text-white text-xs md:text-sm font-medium rounded-full shadow-lg shadow-red-500/30 transition-transform hover:scale-105 flex items-center gap-1 md:gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i> Save Letter
                    </button>
                </div>

                <div class="p-4 md:p-6 space-y-4">
                    <!-- Letter Title -->
                    <div>
                        <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Greeting Title</label>
                        <input type="text" id="letter-title" value="" placeholder="Hai Anya..." class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-red-400 focus:border-transparent outline-none transition backdrop-blur-sm font-serif text-lg">
                    </div>

                    <!-- Letter Content -->
                    <div>
                        <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Letter Content</label>
                        <textarea id="letter-content" rows="6" placeholder="Write your heartfelt message here..." class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-red-400 focus:border-transparent outline-none transition backdrop-blur-sm resize-none"></textarea>
                        <p class="text-xs text-slate-400 mt-2">Tip: Use line breaks to separate paragraphs</p>
                    </div>

                    <!-- Closing Quote -->
                    <div>
                        <label class="block text-sm font-bold mb-2 text-slate-700 dark:text-slate-300">Closing Quote</label>
                        <input type="text" id="letter-quote" value="" placeholder="I love you, today and forever." class="w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-900/50 focus:ring-2 focus:ring-red-400 focus:border-transparent outline-none transition backdrop-blur-sm font-serif italic">
                    </div>

                    <!-- Preview Card -->
                    <div class="mt-6 p-4 bg-gradient-to-br from-pink-50 to-red-50 dark:from-slate-800 dark:to-slate-900 rounded-2xl border border-pink-100 dark:border-slate-700">
                        <div class="flex items-center gap-2 text-red-400 mb-2">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                            <span class="text-xs font-bold uppercase tracking-wider">Preview</span>
                        </div>
                        <div class="text-center py-4">
                            <div class="w-10 h-10 bg-pink-100 dark:bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-3 text-pink-500">
                                <i data-lucide="heart-handshake" class="w-5 h-5"></i>
                            </div>
                            <h4 id="letter-preview-title" class="font-serif text-xl text-slate-800 dark:text-white mb-3">Hai Anya...</h4>
                            <p id="letter-preview-content" class="text-sm text-slate-600 dark:text-slate-400 leading-relaxed whitespace-pre-line">Your message will appear here...</p>
                            <p id="letter-preview-quote" class="font-serif italic text-red-500 dark:text-red-400 mt-4 font-bold">"I love you, today and forever."</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Init Plugins
        lucide.createIcons();
        AOS.init({
            once: true,
            offset: 50,
            duration: 800,
        });

        // Sidebar Logic
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar.classList.contains('-translate-x-full')) {
                // Open
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                // Close
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        // Theme Logic
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }

        // Image Preview Logic
        function updatePreview(input, imgId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(imgId).src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Sasuke Image Upload Functions
        function updateSasukePreview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('sasukePreview').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function saveSasukeImage() {
            const fileInput = document.getElementById('sasukeImageInput');
            const name = document.getElementById('sasukeName').value.trim();
            const description = document.getElementById('sasukeDescription').value.trim();
            const saveBtn = document.getElementById('saveSasukeBtn');
            
            if (!fileInput.files || !fileInput.files[0]) {
                alert('Please select an image first');
                return;
            }
            
            if (!name) {
                alert('Please enter a name/label');
                return;
            }
            
            try {
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i data-lucide="loader" class="w-4 h-4 animate-spin"></i> Saving...';
                lucide.createIcons();
                
                // Compress image to Base64 (600px max width, 0.8 quality)
                const base64Image = await window.compressImageToBase64(fileInput.files[0], 600, 0.8);
                
                // Save to Firestore landing/sasukeImage
                const { doc, setDoc, serverTimestamp } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                const { db } = await import('../js/firebase-config.js');
                
                await setDoc(doc(db, 'landing', 'sasukeImage'), {
                    url: base64Image,
                    name: name,
                    description: description,
                    updatedAt: serverTimestamp()
                });
                
                saveBtn.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i> Saved!';
                saveBtn.classList.remove('bg-slate-700');
                saveBtn.classList.add('bg-green-600');
                lucide.createIcons();
                
                setTimeout(() => {
                    saveBtn.innerHTML = '<i data-lucide="save" class="w-4 h-4"></i> Save Image';
                    saveBtn.classList.remove('bg-green-600');
                    saveBtn.classList.add('bg-slate-700');
                    saveBtn.disabled = false;
                    lucide.createIcons();
                }, 2000);
                
            } catch (error) {
                console.error('Save error:', error);
                alert('Failed to save image: ' + error.message);
                saveBtn.innerHTML = '<i data-lucide="save" class="w-4 h-4"></i> Save Image';
                saveBtn.disabled = false;
                lucide.createIcons();
            }
        }

        // Load Sasuke image on page load
        async function loadSasukeImage() {
            try {
                const { doc, getDoc } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");
                const { db } = await import('../js/firebase-config.js');
                
                const sasukeDoc = await getDoc(doc(db, 'landing', 'sasukeImage'));
                if (sasukeDoc.exists()) {
                    const data = sasukeDoc.data();
                    document.getElementById('sasukePreview').src = data.url || '';
                    document.getElementById('sasukeName').value = data.name || 'Sasuke Uchiha';
                    document.getElementById('sasukeDescription').value = data.description || '0% - Stranger/Friendzone marker';
                }
            } catch (error) {
                console.error('Error loading Sasuke image:', error);
            }
        }

        // Logout Logic (Firebase)
        async function logout() {
            if(confirm('Are you sure you want to logout?')) {
                try {
                    const { signOut } = await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js");
                    const { auth } = await import('../js/firebase-config.js');
                    await signOut(auth);
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Failed to logout. Please try again.');
                }
            }
        }
    </script>
</body>
</html>